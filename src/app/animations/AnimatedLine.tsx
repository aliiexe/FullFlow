'use client';
import gsap from 'gsap';
import '../styles/line.css';
import { useRef, useEffect, useState } from 'react';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

const AnimatedLine = () => {
  const containerRef = useRef<HTMLDivElement>(null);
  const largeSvgRef = useRef<SVGSVGElement>(null);
  const smallSvgRef = useRef<SVGSVGElement>(null);
  const [isMobile, setIsMobile] = useState(false);

  // Check screen size
  useEffect(() => {
    const checkScreenSize = () => {
      setIsMobile(window.innerWidth <= 768);
    };
    
    // Initial check
    checkScreenSize();
    
    // Listen for resize events
    window.addEventListener('resize', checkScreenSize);
    return () => window.removeEventListener('resize', checkScreenSize);
  }, []);

  useEffect(() => {
    gsap.registerPlugin(ScrollTrigger);
  
    // Determine which SVG to animate based on screen size
    const svg = isMobile ? smallSvgRef.current : largeSvgRef.current;
    if (!svg) return;
    
    const paths = svg.querySelectorAll('path');
    if (!paths.length) return;
  
    // Define different scroll configurations based on screen size
    const scrollConfig = {
      trigger: containerRef.current,
      start: isMobile ? "top 10%" : "top 40%", // Start earlier on mobile
      end: isMobile ? "bottom 90%" : "bottom bottom", // End sooner on mobile
      scrub: isMobile ? 0.8 : 1, // Slightly faster scrub on mobile
      // markers: true, // Uncomment to debug
    };
    
    paths.forEach((path) => {
      const pathLength = path.getTotalLength();
      gsap.set(path, { strokeDasharray: pathLength });
      gsap.fromTo(
        path,
        { strokeDashoffset: pathLength },
        {
          strokeDashoffset: 0,
          duration: isMobile ? 8 : 10, // Slightly shorter duration on mobile
          ease: "none",
          scrollTrigger: scrollConfig,
        }
      );
    });
  
    return () => {
      ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
    };
  }, [isMobile]); // Re-run when screen size changes

  return (
    <>
      <div className="svg-container" ref={containerRef}>
        {/* Large SVG for desktop - hidden on mobile */}
        <svg 
          className="gradient-line large-line" 
          ref={largeSvgRef} 
          width="100%" 
          height="10000" 
          viewBox="0 0 1898 10000" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
          style={{ display: isMobile ? 'none' : 'block' }}
        >
          {/* SVG content stays the same */}
          <defs>
            <linearGradient id="lineGradientLarge" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stopColor="#FF0080" />
              <stop offset="25%" stopColor="#F352F0" />
              <stop offset="50%" stopColor="#EA8221" />
              <stop offset="75%" stopColor="#FF7600" />
              <stop offset="100%" stopColor="#FFCC00" />
            </linearGradient>
          </defs>

          <path
            d="M1291 -411.5C1291 -411.5 854.218 122.867 1034.72 385.867C1179.12 596.267 1554.22 658.867 1723.72 663.867C1969.72 658.033 2258.94 800.998 1992.72 1222.37C1771.49 1572.53 1460.86 1302.33 1119 1345.5C885.938 1374.93 743.945 1490.51 521.5 1415C431.219 1384.35 313.789 1397.63 307.501 1297.5C301.213 1197.37 437.837 1152 498.501 1265C559.164 1378 423.902 1413.3 374.501 1507.5C146.42 1942.4 -643.56 2253.61 374.501 2193.5C771.143 2170.08 1444.22 2152.29 2107.72 2975.87C2472.03 3428.07 1774.72 3222.93 1559.72 3379C1133.79 3688.19 1032.02 4223.8 459.219 4157C-113.581 4090.2 -94.448 3809.17 -13.2813 3677C69.2187 3584 315.018 3473.9 638.218 3777.5C1042.22 4157 770.718 4354 638.218 4386C505.718 4418 -415.781 4448.5 -374.281 5129.5C-332.781 5810.5 -134.508 5913.94 262.22 5921.5C925.001 5934.13 1511.49 5176.36 1723.72 5713C1906.74 6175.79 1168.22 6088 1168.22 6088C1168.22 6088 515.975 5987.87 184.219 6185.5C-245.614 6441.55 -532.809 6863.96 -374.281 7338.5C-237.694 7747.36 191.132 7606.8 459.219 7419.5C517.124 7379.04 591.5 7335.13 591.5 7296.13C591.5 7257.13 573 7224.13 533 7213.13C493 7202.13 425.5 7220.13 440.5 7296.13C455.5 7372.13 657.23 7514.49 838 7554C1099.44 7611.14 1226.71 7282.95 1488.5 7338.5C1852.93 7415.82 2033.64 7812.84 2013.5 8135C1987.47 8551.26 989 8078.5 562 8067C135 8055.5 145.27 8223.8 26 8549.5C-94.7468 8879.23 -59.4996 9257.5 498.5 9314.5C1056.5 9371.5 1897 9174 1901.5 9099"            
            stroke="url(#lineGradientLarge)"
            strokeWidth="50"
            strokeLinecap="round"
            fill="none"
          />
          <path
            d="M1291 -411.5C1291 -411.5 854.218 122.867 1034.72 385.867C1179.12 596.267 1554.22 658.867 1723.72 663.867C1969.72 658.033 2258.94 800.998 1992.72 1222.37C1771.49 1572.53 1460.86 1302.33 1119 1345.5C885.938 1374.93 743.945 1490.51 521.5 1415C431.219 1384.35 313.789 1397.63 307.501 1297.5C301.213 1197.37 437.837 1152 498.501 1265C559.164 1378 423.902 1413.3 374.501 1507.5C146.42 1942.4 -643.56 2253.61 374.501 2193.5C771.143 2170.08 1444.22 2152.29 2107.72 2975.87C2472.03 3428.07 1774.72 3222.93 1559.72 3379C1133.79 3688.19 1032.02 4223.8 459.219 4157C-113.581 4090.2 -94.448 3809.17 -13.2813 3677C69.2187 3584 315.018 3473.9 638.218 3777.5C1042.22 4157 770.718 4354 638.218 4386C505.718 4418 -415.781 4448.5 -374.281 5129.5C-332.781 5810.5 -134.508 5913.94 262.22 5921.5C925.001 5934.13 1511.49 5176.36 1723.72 5713C1906.74 6175.79 1168.22 6088 1168.22 6088C1168.22 6088 515.975 5987.87 184.219 6185.5C-245.614 6441.55 -532.809 6863.96 -374.281 7338.5C-237.694 7747.36 191.132 7606.8 459.219 7419.5C517.124 7379.04 591.5 7335.13 591.5 7296.13C591.5 7257.13 573 7224.13 533 7213.13C493 7202.13 425.5 7220.13 440.5 7296.13C455.5 7372.13 657.23 7514.49 838 7554C1099.44 7611.14 1226.71 7282.95 1488.5 7338.5C1852.93 7415.82 2033.64 7812.84 2013.5 8135C1987.47 8551.26 989 8078.5 562 8067C135 8055.5 145.27 8223.8 26 8549.5C-94.7468 8879.23 -59.4996 9257.5 498.5 9314.5C1056.5 9371.5 1897 9174 1901.5 9099"            
            stroke="url(#lineGradientLarge)"
            // stroke="url(#lineGradientLarge)"
            strokeWidth="35"
            strokeLinecap="round"
            fill="none"
          />
        </svg>
        
        {/* Small SVG for mobile - hidden on desktop */}
        <svg 
          className="gradient-line small-line" 
          ref={smallSvgRef} 
          width="100%" 
          height="5703" 
          viewBox="0 0 430 5703" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
          style={{ display: isMobile ? 'block' : 'none' }}
        >
          {/* SVG content stays the same */}
          <defs>
            <linearGradient id="lineGradientSmall" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stopColor="#FF0080" />
              <stop offset="25%" stopColor="#F352F0" />
              <stop offset="50%" stopColor="#EA8221" />
              <stop offset="75%" stopColor="#FF7600" />
              <stop offset="100%" stopColor="#FFCC00" />
            </linearGradient>
          </defs>
          <path
            d="M344.094 -24C344.094 -24 201.751 289.007 260.574 443.06C307.633 566.303 429.875 602.971 485.114 605.899C565.283 602.483 659.537 686.224 572.779 933.043C500.681 1138.15 399.452 979.882 288.041 1005.17C212.088 1022.41 165.814 1090.11 93.3212 1045.88C63.8993 1027.93 25.6298 1035.7 23.5806 977.052C21.5314 918.4 66.056 891.827 85.8258 958.015C105.596 1024.2 61.5146 1044.88 45.4153 1100.06C-28.9142 1354.8 -286.362 1537.1 45.4153 1501.89C174.677 1488.17 394.028 1477.75 610.256 1960.16C728.981 2225.04 501.734 2104.88 431.668 2196.3C292.861 2377.41 259.695 2691.14 73.0241 2652.01C-113.646 2612.88 -107.411 2448.27 -80.9594 2370.85C-54.0734 2316.38 26.0303 2251.89 131.358 2429.72C263.018 2652.01 174.539 2767.41 131.358 2786.15C88.1777 2804.89 -212.131 2822.76 -198.606 3221.66C-185.082 3620.56 -120.466 3681.14 8.82388 3685.57C224.818 3692.98 415.95 3249.11 485.114 3563.45C544.76 3834.53 304.08 3783.1 304.08 3783.1C304.08 3783.1 91.5204 3724.45 -16.5958 3840.21C-156.674 3990.2 -250.269 4237.62 -198.606 4515.59C-154.093 4755.08 -14.3428 4672.75 73.0241 4563.03C91.895 4539.34 116.133 4513.61 116.133 4490.77C116.133 4467.93 110.104 4448.6 97.0687 4442.15C84.033 4435.71 62.0355 4446.25 66.9238 4490.77C71.8122 4535.29 137.554 4618.68 196.466 4641.82C281.667 4675.29 323.144 4483.05 408.458 4515.59C527.223 4560.88 586.115 4793.43 579.551 4982.14C571.069 5225.96 245.675 4949.04 106.52 4942.31C-32.6358 4935.57 -29.2888 5034.16 -68.158 5224.93C-107.508 5418.07 -96.0215 5639.65 85.8256 5673.04C267.673 5706.42 541.584 5590.74 543.051 5546.81"
            stroke="url(#lineGradientSmall)"
            strokeWidth="30"
            strokeLinecap="round"
            fill="none"
          />
          <path
            d="M344.094 -24C344.094 -24 201.751 289.007 260.574 443.06C307.633 566.303 429.875 602.971 485.114 605.899C565.283 602.483 659.537 686.224 572.779 933.043C500.681 1138.15 399.452 979.882 288.041 1005.17C212.088 1022.41 165.814 1090.11 93.3212 1045.88C63.8993 1027.93 25.6298 1035.7 23.5806 977.052C21.5314 918.4 66.056 891.827 85.8258 958.015C105.596 1024.2 61.5146 1044.88 45.4153 1100.06C-28.9142 1354.8 -286.362 1537.1 45.4153 1501.89C174.677 1488.17 394.028 1477.75 610.256 1960.16C728.981 2225.04 501.734 2104.88 431.668 2196.3C292.861 2377.41 259.695 2691.14 73.0241 2652.01C-113.646 2612.88 -107.411 2448.27 -80.9594 2370.85C-54.0734 2316.38 26.0303 2251.89 131.358 2429.72C263.018 2652.01 174.539 2767.41 131.358 2786.15C88.1777 2804.89 -212.131 2822.76 -198.606 3221.66C-185.082 3620.56 -120.466 3681.14 8.82388 3685.57C224.818 3692.98 415.95 3249.11 485.114 3563.45C544.76 3834.53 304.08 3783.1 304.08 3783.1C304.08 3783.1 91.5204 3724.45 -16.5958 3840.21C-156.674 3990.2 -250.269 4237.62 -198.606 4515.59C-154.093 4755.08 -14.3428 4672.75 73.0241 4563.03C91.895 4539.34 116.133 4513.61 116.133 4490.77C116.133 4467.93 110.104 4448.6 97.0687 4442.15C84.033 4435.71 62.0355 4446.25 66.9238 4490.77C71.8122 4535.29 137.554 4618.68 196.466 4641.82C281.667 4675.29 323.144 4483.05 408.458 4515.59C527.223 4560.88 586.115 4793.43 579.551 4982.14C571.069 5225.96 245.675 4949.04 106.52 4942.31C-32.6358 4935.57 -29.2888 5034.16 -68.158 5224.93C-107.508 5418.07 -96.0215 5639.65 85.8256 5673.04C267.673 5706.42 541.584 5590.74 543.051 5546.81"
            stroke="url(#lineGradientSmall)"
            strokeWidth="20"
            strokeLinecap="round"
            fill="none"
          />
        </svg>
      </div>
    </>
  );
};

export default AnimatedLine;