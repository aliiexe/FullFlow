'use client';
import gsap from 'gsap';
import '../styles/line.css';
import { useRef, useEffect, useState } from 'react';
import { ScrollTrigger } from 'gsap/ScrollTrigger';

const AnimatedLine = () => {
  const containerRef = useRef<HTMLDivElement>(null);
  const largeSvgRef = useRef<SVGSVGElement>(null);
  const smallSvgRef = useRef<SVGSVGElement>(null);
  const [isMobile, setIsMobile] = useState(false);

  // Check screen size
  useEffect(() => {
    const checkScreenSize = () => {
      setIsMobile(window.innerWidth <= 768);
    };
    
    // Initial check
    checkScreenSize();
    
    // Listen for resize events
    window.addEventListener('resize', checkScreenSize);
    return () => window.removeEventListener('resize', checkScreenSize);
  }, []);

  useEffect(() => {
    gsap.registerPlugin(ScrollTrigger);
  
    // Determine which SVG to animate based on screen size
    const svg = isMobile ? smallSvgRef.current : largeSvgRef.current;
    if (!svg) return;
    
    const paths = svg.querySelectorAll('path');
    if (!paths.length) return;
  
    // Define different scroll configurations based on screen size
    const scrollConfig = {
      trigger: containerRef.current,
      start: isMobile ? "top 10%" : "top 40%", // Start earlier on mobile
      end: isMobile ? "bottom 90%" : "bottom bottom", // End sooner on mobile
      scrub: isMobile ? 0.8 : 1, // Slightly faster scrub on mobile
      // markers: true, // Uncomment to debug
    };
    
    paths.forEach((path) => {
      const pathLength = path.getTotalLength();
      gsap.set(path, { strokeDasharray: pathLength });
      gsap.fromTo(
        path,
        { strokeDashoffset: pathLength },
        {
          strokeDashoffset: 0,
          duration: 10, // Slightly shorter duration on mobile
          ease: "none",
          scrollTrigger: scrollConfig,
        }
      );
    });
  
    return () => {
      ScrollTrigger.getAll().forEach((trigger) => trigger.kill());
    };
  }, [isMobile]); // Re-run when screen size changes

  return (
    <>
      <div className="svg-container" ref={containerRef}>
        {/* Large SVG for desktop - hidden on mobile */}
        <svg 
          className="gradient-line large-line" 
          ref={largeSvgRef} 
          width="100%" 
          height="7300" 
          viewBox="0 0 1898 7300" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
          style={{ display: isMobile ? 'none' : 'block' }}
        >
          {/* SVG content stays the same */}
          <defs>
            <linearGradient id="lineGradientLarge" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stopColor="#FF0080" />
              <stop offset="25%" stopColor="#F352F0" />
              <stop offset="50%" stopColor="#EA8221" />
              <stop offset="75%" stopColor="#FF7600" />
              <stop offset="100%" stopColor="#FFCC00" />
            </linearGradient>
          </defs>

          <path
            d="M2201.5 30C2201.5 30 1530.33 90.2953 1446 393.5C1393.7 581.55 1339.1 875 1534 885.5C1826.13 901.238 1910.21 750.077 1797.5 610C1540.13 290.139 1252.5 1187.69 842.499 1166.5C672.852 1157.73 346.901 1214.1 420.499 1061C473.19 951.392 599.387 913.444 713.499 955.5C888.645 1020.05 659.158 1323.16 478.999 1372C412.85 1389.93 369.712 1354.3 303.499 1372C83.015 1430.93 18.2607 1744.7 144.999 1934.5C237.252 2072.65 375.38 2062.25 537.499 2098.5C913.341 2182.54 1140.01 1780.63 1504.5 1905C1827.53 2015.22 2148.56 2185.92 2119.5 2526C2098.3 2774.06 1867.13 2479.45 1670 2631.5C1506.19 2757.85 1466.34 2915.89 1265.5 2965.5C1041.24 3020.89 942.914 3436.03 725.499 3358C570.187 3302.26 296 3280.5 318.5 3169C341 3057.5 470.001 2959.5 575.501 3059C681 3158.5 427.845 3326.79 267.5 3547C190.222 3653.13 315.499 3704 256.499 3850.5C197.5 3997 92.8451 3966.47 51.4994 4079C-60.0697 4382.65 574.512 4143.8 842.499 4325C984.655 4421.12 1152.95 4452.79 1164.5 4624C1174.23 4768.27 981.677 4795.76 971.499 4940C957.919 5132.48 1062.49 5292.43 1246.5 5350.5C1439.17 5411.3 1519.88 5158.5 1721.5 5145.5C1959.03 5130.18 2263.34 5114.65 2295.5 5350.5C2324.36 5562.14 2100.96 5644.37 1908.5 5737C1547.49 5910.75 1306.19 5480.43 906.999 5514.5C552.066 5544.8 154.618 5490.03 51.4994 5831C-37.3534 6124.8 172.366 6331.46 402.999 6534C712.844 6806.1 1033.98 6805.06 1440 6733C1759.33 6676.32 2184 6364 2184 6364"            
            stroke="url(#lineGradientLarge)"
            strokeWidth="50"
            strokeLinecap="round"
            fill="none"
          />
          <path
            d="M2201.5 30C2201.5 30 1530.33 90.2953 1446 393.5C1393.7 581.55 1339.1 875 1534 885.5C1826.13 901.238 1910.21 750.077 1797.5 610C1540.13 290.139 1252.5 1187.69 842.499 1166.5C672.852 1157.73 346.901 1214.1 420.499 1061C473.19 951.392 599.387 913.444 713.499 955.5C888.645 1020.05 659.158 1323.16 478.999 1372C412.85 1389.93 369.712 1354.3 303.499 1372C83.015 1430.93 18.2607 1744.7 144.999 1934.5C237.252 2072.65 375.38 2062.25 537.499 2098.5C913.341 2182.54 1140.01 1780.63 1504.5 1905C1827.53 2015.22 2148.56 2185.92 2119.5 2526C2098.3 2774.06 1867.13 2479.45 1670 2631.5C1506.19 2757.85 1466.34 2915.89 1265.5 2965.5C1041.24 3020.89 942.914 3436.03 725.499 3358C570.187 3302.26 296 3280.5 318.5 3169C341 3057.5 470.001 2959.5 575.501 3059C681 3158.5 427.845 3326.79 267.5 3547C190.222 3653.13 315.499 3704 256.499 3850.5C197.5 3997 92.8451 3966.47 51.4994 4079C-60.0697 4382.65 574.512 4143.8 842.499 4325C984.655 4421.12 1152.95 4452.79 1164.5 4624C1174.23 4768.27 981.677 4795.76 971.499 4940C957.919 5132.48 1062.49 5292.43 1246.5 5350.5C1439.17 5411.3 1519.88 5158.5 1721.5 5145.5C1959.03 5130.18 2263.34 5114.65 2295.5 5350.5C2324.36 5562.14 2100.96 5644.37 1908.5 5737C1547.49 5910.75 1306.19 5480.43 906.999 5514.5C552.066 5544.8 154.618 5490.03 51.4994 5831C-37.3534 6124.8 172.366 6331.46 402.999 6534C712.844 6806.1 1033.98 6805.06 1440 6733C1759.33 6676.32 2184 6364 2184 6364"            
            stroke="url(#lineGradientLarge)"
            // stroke="url(#lineGradientLarge)"
            strokeWidth="35"
            strokeLinecap="round"
            fill="none"
          />
        </svg>
        
        {/* Small SVG for mobile - hidden on desktop */}
        <svg 
          className="gradient-line small-line" 
          ref={smallSvgRef} 
          width="100%" 
          height="5703" 
          viewBox="0 0 430 5703" 
          fill="none" 
          xmlns="http://www.w3.org/2000/svg"
          style={{ display: isMobile ? 'block' : 'none' }}
        >
          {/* SVG content stays the same */}
          <defs>
            <linearGradient id="lineGradientSmall" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stopColor="#FF0080" />
              <stop offset="25%" stopColor="#F352F0" />
              <stop offset="50%" stopColor="#EA8221" />
              <stop offset="75%" stopColor="#FF7600" />
              <stop offset="100%" stopColor="#FFCC00" />
            </linearGradient>
          </defs>
          <path
            d="M344.094 -24C344.094 -24 201.751 289.007 260.574 443.06C307.633 566.303 429.875 602.971 485.114 605.899C565.283 602.483 659.537 686.224 572.779 933.043C500.681 1138.15 399.452 979.882 288.041 1005.17C212.088 1022.41 165.814 1090.11 93.3212 1045.88C63.8993 1027.93 25.6298 1035.7 23.5806 977.052C21.5314 918.4 66.056 891.827 85.8258 958.015C105.596 1024.2 61.5146 1044.88 45.4153 1100.06C-28.9142 1354.8 -286.362 1537.1 45.4153 1501.89C174.677 1488.17 394.028 1477.75 610.256 1960.16C728.981 2225.04 501.734 2104.88 431.668 2196.3C292.861 2377.41 259.695 2691.14 73.0241 2652.01C-113.646 2612.88 -107.411 2448.27 -80.9594 2370.85C-54.0734 2316.38 26.0303 2251.89 131.358 2429.72C263.018 2652.01 174.539 2767.41 131.358 2786.15C88.1777 2804.89 -212.131 2822.76 -198.606 3221.66C-185.082 3620.56 -120.466 3681.14 8.82388 3685.57C224.818 3692.98 415.95 3249.11 485.114 3563.45C544.76 3834.53 304.08 3783.1 304.08 3783.1C304.08 3783.1 91.5204 3724.45 -16.5958 3840.21C-156.674 3990.2 -250.269 4237.62 -198.606 4515.59C-154.093 4755.08 -14.3428 4672.75 73.0241 4563.03C91.895 4539.34 116.133 4513.61 116.133 4490.77C116.133 4467.93 110.104 4448.6 97.0687 4442.15C84.033 4435.71 62.0355 4446.25 66.9238 4490.77C71.8122 4535.29 137.554 4618.68 196.466 4641.82C281.667 4675.29 323.144 4483.05 408.458 4515.59C527.223 4560.88 586.115 4793.43 579.551 4982.14C571.069 5225.96 245.675 4949.04 106.52 4942.31C-32.6358 4935.57 -29.2888 5034.16 -68.158 5224.93C-107.508 5418.07 -96.0215 5639.65 85.8256 5673.04C267.673 5706.42 541.584 5590.74 543.051 5546.81"
            stroke="url(#lineGradientSmall)"
            strokeWidth="30"
            strokeLinecap="round"
            fill="none"
          />
          <path
            d="M344.094 -24C344.094 -24 201.751 289.007 260.574 443.06C307.633 566.303 429.875 602.971 485.114 605.899C565.283 602.483 659.537 686.224 572.779 933.043C500.681 1138.15 399.452 979.882 288.041 1005.17C212.088 1022.41 165.814 1090.11 93.3212 1045.88C63.8993 1027.93 25.6298 1035.7 23.5806 977.052C21.5314 918.4 66.056 891.827 85.8258 958.015C105.596 1024.2 61.5146 1044.88 45.4153 1100.06C-28.9142 1354.8 -286.362 1537.1 45.4153 1501.89C174.677 1488.17 394.028 1477.75 610.256 1960.16C728.981 2225.04 501.734 2104.88 431.668 2196.3C292.861 2377.41 259.695 2691.14 73.0241 2652.01C-113.646 2612.88 -107.411 2448.27 -80.9594 2370.85C-54.0734 2316.38 26.0303 2251.89 131.358 2429.72C263.018 2652.01 174.539 2767.41 131.358 2786.15C88.1777 2804.89 -212.131 2822.76 -198.606 3221.66C-185.082 3620.56 -120.466 3681.14 8.82388 3685.57C224.818 3692.98 415.95 3249.11 485.114 3563.45C544.76 3834.53 304.08 3783.1 304.08 3783.1C304.08 3783.1 91.5204 3724.45 -16.5958 3840.21C-156.674 3990.2 -250.269 4237.62 -198.606 4515.59C-154.093 4755.08 -14.3428 4672.75 73.0241 4563.03C91.895 4539.34 116.133 4513.61 116.133 4490.77C116.133 4467.93 110.104 4448.6 97.0687 4442.15C84.033 4435.71 62.0355 4446.25 66.9238 4490.77C71.8122 4535.29 137.554 4618.68 196.466 4641.82C281.667 4675.29 323.144 4483.05 408.458 4515.59C527.223 4560.88 586.115 4793.43 579.551 4982.14C571.069 5225.96 245.675 4949.04 106.52 4942.31C-32.6358 4935.57 -29.2888 5034.16 -68.158 5224.93C-107.508 5418.07 -96.0215 5639.65 85.8256 5673.04C267.673 5706.42 541.584 5590.74 543.051 5546.81"
            stroke="url(#lineGradientSmall)"
            strokeWidth="20"
            strokeLinecap="round"
            fill="none"
          />
        </svg>
      </div>
    </>
  );
};

export default AnimatedLine;